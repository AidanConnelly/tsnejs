/*! @jwalsh/tsnejs - 0.1.0 */
!function(t){function r(e){if(i[e])return i[e].exports;var a=i[e]={exports:{},id:e,loaded:!1};return t[e].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}var i={};return r.m=t,r.c=i,r.p="",r(0)}([function(t,r,i){window.tsnejs=i(1)},function(t,r){"use strict";function i(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function e(t){return t>0?1:t<0?-1:0}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function t(t,r){for(var i=0;i<r.length;i++){var e=r[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(r,i,e){return i&&t(r.prototype,i),e&&t(r,e),r}}();r.sign=e;var n=function(t,r){if(!t)throw r||"Assertion failed"},o=function(t,r,i){return t.hasOwnProperty(r)?t[r]:i},s=!1,h=0,u=r.gaussRandom=function t(){if(s)return s=!1,h;var r=2*Math.random()-1,i=2*Math.random()-1,e=r*r+i*i;if(0==e||e>1)return t();var a=Math.sqrt(-2*Math.log(e)/e);return h=i*a,s=!0,r*a},f=r.randn=function(t,r){return t+u()*r},v=function(t){if("undefined"==typeof t||isNaN(t))return[];if("undefined"==typeof ArrayBuffer){for(var r=new Array(t),i=0;i<t;i++)r[i]=0;return r}return new Float64Array(t)},l=r.randn2d=function(t,r,i){for(var e="undefined"!=typeof i,a=[],n=0;n<t;n++){for(var o=[],s=0;s<r;s++)e?o.push(i):o.push(f(0,1e-4));a.push(o)}return a},c=r.L2=function(t,r){for(var i=t.length,e=0,a=0;a<i;a++){var n=t[a],o=r[a];e+=(n-o)*(n-o)}return e},d=r.xtod=function(t){for(var r=t.length,i=v(r*r),e=0;e<r;e++)for(var a=e+1;a<r;a++){var n=c(t[e],t[a]);i[e*r+a]=n,i[a*r+e]=n}return i},p=r.d2p=function(t,r,i){var e=Math.sqrt(t.length),a=Math.floor(e);n(a===e,"D should have square number of elements.");for(var o=Math.log(r),s=v(a*a),h=v(a),u=0;u<a;u++){for(var f=-(1/0),l=1/0,c=1,d=!1,p=50,y=0;!d;){for(var m=0,g=0;g<a;g++){var Y=Math.exp(-t[u*a+g]*c);u===g&&(Y=0),h[g]=Y,m+=Y}for(var M=0,g=0;g<a;g++){if(0==m)var Y=0;else var Y=h[g]/m;h[g]=Y,Y>1e-7&&(M-=Y*Math.log(Y))}M>o?(f=c,l===1/0?c*=2:c=(c+l)/2):(l=c,f===-(1/0)?c/=2:c=(c+f)/2),y++,Math.abs(M-o)<i&&(d=!0),y>=p&&(d=!0)}for(var g=0;g<a;g++)s[u*a+g]=h[g]}for(var x=v(a*a),w=2*a,u=0;u<a;u++)for(var g=0;g<a;g++)x[u*a+g]=Math.max((s[u*a+g]+s[g*a+u])/w,1e-100);return x};r.tSNE=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),this.perplexity=o(r,"perplexity",30),this.dim=o(r,"dim",2),this.epsilon=o(r,"epsilon",10),this.iter=0}return a(t,[{key:"initDataRaw",value:function(t){var r=t.length,i=t[0].length;n(r>0," X is empty? You must have some data!"),n(i>0," X[0] is empty? Where is the data?");var e=d(t);this.P=p(e,this.perplexity,1e-4),this.N=r,this.initSolution()}},{key:"initDataDist",value:function(t){var r=t.length;n(r>0," X is empty? You must have some data!");for(var i=v(r*r),e=0;e<r;e++)for(var a=e+1;a<r;a++){var o=t[e][a];i[e*r+a]=o,i[a*r+e]=o}this.P=p(i,this.perplexity,1e-4),this.N=r,this.initSolution()}},{key:"initSolution",value:function(){this.Y=l(this.N,this.dim),this.gains=l(this.N,this.dim,1),this.ystep=l(this.N,this.dim,0),this.iter=0}},{key:"getSolution",value:function(){return this.Y}},{key:"step",value:function(){this.iter+=1;for(var t=this.N,r=this.costGrad(this.Y),i=r.cost,a=r.grad,n=v(this.dim),o=0;o<t;o++)for(var s=0;s<this.dim;s++){var h=a[o][s],u=this.ystep[o][s],f=this.gains[o][s],l=e(h)===e(u)?.8*f:f+.2;l<.01&&(l=.01),this.gains[o][s]=l;var c=this.iter<250?.5:.8,d=c*u-this.epsilon*l*a[o][s];this.ystep[o][s]=d,this.Y[o][s]+=d,n[s]+=this.Y[o][s]}for(var o=0;o<t;o++)for(var s=0;s<this.dim;s++)this.Y[o][s]-=n[s]/t;return i}},{key:"debugGrad",value:function(){for(var t=this.N,r=this.costGrad(this.Y),i=(r.cost,r.grad),e=1e-5,a=0;a<t;a++)for(var n=0;n<this.dim;n++){var o=this.Y[a][n];this.Y[a][n]=o+e;var s=this.costGrad(this.Y);this.Y[a][n]=o-e;var h=this.costGrad(this.Y),u=i[a][n],f=(s.cost-h.cost)/(2*e);console.log(a+","+n+": gradcheck analytic: "+u+" vs. numerical: "+f),this.Y[a][n]=o}}},{key:"costGrad",value:function(t){for(var r=this.N,i=this.dim,e=this.P,a=this.iter<100?4:1,n=v(r*r),o=0,s=0;s<r;s++)for(var h=s+1;h<r;h++){for(var u=0,f=0;f<i;f++){var l=t[s][f]-t[h][f];u+=l*l}var c=1/(1+u);n[s*r+h]=c,n[h*r+s]=c,o+=2*c}for(var d=r*r,p=v(d),y=0;y<d;y++)p[y]=Math.max(n[y]/o,1e-100);for(var m=0,g=[],s=0;s<r;s++){for(var Y=new Array(i),f=0;f<i;f++)Y[f]=0;for(var h=0;h<r;h++){m+=-e[s*r+h]*Math.log(p[s*r+h]);for(var M=4*(a*e[s*r+h]-p[s*r+h])*n[s*r+h],f=0;f<i;f++)Y[f]+=M*(t[s][f]-t[h][f])}g.push(Y)}return{cost:m,grad:g}}}]),t}()}]);
//# sourceMappingURL=bundle.min.js.map